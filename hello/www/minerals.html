<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <script type="text/javascript" src="js/index.js"></script>
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <title>Killhope App</title>
        
        <script type="text/javascript" src="../plugins/jQuery/jquery-2.1.3.min.js"></script>
        <script type="text/javascript">
        
			$(document).ready(function() {
				//$(".app").css("background-image", "url(\"img/minerals/sphalerite/1.JPG\")");
			});
			
			var url = location.href;
			var parameters = url.split("?")[1];
			var current_page = parameters.replace("page=","");
        	
        	var minerals;
        	var glossary;
    		
	        var test = jQuery.getJSON("info/glossary.json", function(data){
	        	console.log("success");
	        	glossary = data.glossary;
	        })
	        .fail(function( jqxhr, textStatus, error ) {
    			var err = textStatus + ", " + error;
    			console.log( "Request Failed: " + err );
    		});
	        var test = jQuery.getJSON("info/mineralInfo.json", function(data){
	        	console.log("success");
	        	minerals = data.minerals;
	        	loadMineral(current_page);
	        })
	        .fail(function( jqxhr, textStatus, error ) {
    			var err = textStatus + ", " + error;
    			console.log( "Request Failed: " + err );
    		});
    		
	        function loadMineral(i){
	        	$(".app").css("background-image", "url(\"img/minerals/"+ minerals[i].mainimgpath+ "\")");
	        	$('#title_minerals').text('X    ' + minerals[i].name);
	        	$('.info_list').append('<li class="mineral_info_icons"><a href="3d_model_view.html?page=' + i + '"><img src="img/camera_icon.png"></a><a href="mineral_images.php">3D</a></li>');
	        	$('.info_list').append('<li class="mineral_info"><span class="bold">Formula:</span>' + ' ' + minerals[i].formula + '</li>');
 	        	nextStage(i, 1);
	        	//$('.info_list').animate({ scrollTop: 0 }, "fast");
	        }
	        
	        function nextStage(i, stage) {
	        	$('#more_info').remove();
				for (var name in minerals[i]['stage'+stage]) {
					if (minerals[i]['stage'+stage][name] != "") {
					
// 						for (var text in minerals[i]['stage'+stage][name].split("=>")) {
// 							var segments = text.split("<=");
// 							if (segments.length == 2) info += '<span id="gloss"' + segments[0] + '</span>' + segments[1];
// 							else info += segments[0];
// 						}
						
						$('.info_list').append('<li class="mineral_info"><span class="bold">' + name + ': </span>' + minerals[i]['stage'+stage][name] + '</li>');
					}
				}
	        	if (stage != 4) $('.info_list').append('<li class="mineral_info" id="more_info" onclick="nextStage('+i+', '+(stage+1)+')">More info</li>');
	        	changeColour(minerals[i].boxcolour);
	        }

	        function changeColour(c){
	        	$('.mineral_info').css("background-color", c);
	        	$('#title_minerals').css("background-color", c);
	        	$('.mineral_info_icons').css("background-color", c);
	        }

	        function searchGlossary(term){
	        	return glossary[term];
	        }

	        $(document).on('click','#gloss',function(){
		    	var term = $(this).text();
		    	term = term.substring(0, term.length);
		    	var definition = searchGlossary(term);
		    	//Create overlay
		    	document.getElementById('glossary_overlay').style.display = 'inline';
		    	document.getElementById('glossary_overlay').style.position='absolute';
				document.getElementById('glossary_overlay').style.top='0';
				document.getElementById('glossary_overlay').style.left='0';
				document.getElementById('glossary_overlay').style.width='100%';
				document.getElementById('glossary_overlay').style.height='100%';
				document.getElementById('glossary_overlay').style.backgroundColor='rgba(0,0,0,0.7)';
				document.getElementById('glossary_overlay').style.zIndex='10';
				//Set word style
				document.getElementById("glossary_word").innerHTML = term;
				document.getElementById('glossary_word').style.position = 'absolute';
				document.getElementById('glossary_word').style.height = '45px';
				document.getElementById('glossary_word').style.width = '60%';
				document.getElementById('glossary_word').style.top = '40px';
				document.getElementById('glossary_word').style.right = '0';
				document.getElementById('glossary_word').style.color = 'white';
				document.getElementById('glossary_word').style.display = 'inline';
				document.getElementById('glossary_word').style.backgroundColor = '#AA341D';
				document.getElementById('glossary_word').style.fontWeight = 'bold';
				document.getElementById('glossary_word').style.padding = '5px';
				document.getElementById('glossary_word').style.fontSize = '34px';
				//Set definition style
				document.getElementById('glossary_definition').innerHTML = definition;
				document.getElementById('glossary_definition').style.position = 'absolute';
				document.getElementById('glossary_definition').style.height = '50%';
				document.getElementById('glossary_definition').style.width = '90%';
				document.getElementById('glossary_definition').style.top = '110px';
				document.getElementById('glossary_definition').style.left = '0';
				document.getElementById('glossary_definition').style.color = 'white';
				document.getElementById('glossary_definition').style.display = 'inline';
				document.getElementById('glossary_definition').style.backgroundColor = '#AA341D';
				document.getElementById('glossary_definition').style.fontSize = '30px';
				document.getElementById('glossary_definition').style.padding = '5px';
				//Set back style
				document.getElementById('glossary_back').innerHTML = 'Back';
				document.getElementById('glossary_back').style.position = 'absolute';
				document.getElementById('glossary_back').style.height = '40px';
				document.getElementById('glossary_back').style.width = '80px';
				document.getElementById('glossary_back').style.bottom = '30px';
				document.getElementById('glossary_back').style.left = '0';
				document.getElementById('glossary_back').style.color = 'white';
				document.getElementById('glossary_back').style.display = 'inline';
				document.getElementById('glossary_back').style.backgroundColor = '#AA341D';
				document.getElementById('glossary_back').style.fontSize = '30px';
				document.getElementById('glossary_back').style.padding = '5px';
			});

			//Resets content within glossary
			$(document).on('click','#glossary_back',function(){
				document.getElementById('glossary_overlay').style.display = 'none';
				document.getElementById('glossary_word').style.display = 'none';
				document.getElementById('glossary_definition').style.display = 'none';
				document.getElementById('glossary_back').style.display = 'none';
			});

	        function back(){
	        	location.href = "mineral_list.html";
	        }

        </script>

        
    </head>
    <body>
    <div id="glossary_overlay">
		<div id="glossary_word">
		</div>
		<div id="glossary_definition">
		</div>
		<div id="glossary_back">
		</div>
	</div>
	
	<div class="app">
		<div id="glossary_overlay">
				<div id="glossary_word">
				</div>
				<div id="glossary_definition">
				</div>
				<div id="glossary_back">
				</div>
		</div>
		
		<div class="content">
			<h2 id='title_minerals' onclick='back()'></h2>
			<ul class="info_list">
			</ul>
		</div>
    </div>
    <!--
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    -->
    </body>
</html>
